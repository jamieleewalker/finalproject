package music.service;

import java.util.LinkedList;
import java.util.List;
import java.util.NoSuchElementException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import music.controller.model.ArtistData;
import music.controller.model.ArtistData.SongData;
import music.dao.ArtistDao;
import music.entity.Artist;
import music.entity.Song;

@Service
public class MusicService {
	@Autowired
	private ArtistDao artistDao;
	
	@Transactional(readOnly = false)
	public ArtistData saveArtist(ArtistData artistData) {
		Artist artist = artistData.toArtist();
		Artist dbArtist = artistDao.save(artist);
		
		return new ArtistData(dbArtist);
		}
	
	@Transactional(readOnly = true)
	public ArtistData retrieveArtistById(Long artistId) {
		Artist artist = findArtistById(artistId);
		return new ArtistData(artist);
	}
	
	private Song findSongById(Long songId) {
		return artistDao.findById(songId).orElseThrow(() 
				-> new NoSuchElementException("song with ID=" + songId + " was not found"));
	}
	@Transactional(readOnly = true)
	public List<ArtistData> retrieveAllArtist() {
		List<Artist> artistEntities = artistDao.findAll();
		List<ArtistData> artistDtos = new LinkedList<>();
		
		artistEntities.sort((art1, art2) -> art1.getFirstName().compareTo(art2.getFirstName()));
		
		for(Artist song : artistEntities) {
			SongData songData = new SongData(song);
			songDtos.add(songData);
		}
		return songDtos;		
	}
	
	@Transactional(readOnly = false)
	public void deleteSong(Long songId) {
		Song song = findSongById(songId);
		artistDao.delete(song);
	}
}
